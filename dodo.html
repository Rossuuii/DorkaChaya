<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>SÃ¼ÃŸe Hearts-App</title>
<style>
  /* small reset to remove leftover margins/paddings and make centering reliable */
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root{
    --accent: #d63384;
    --bg1: #ffe6ef;
    --bg2: #dfe9ff;
    --bg3: #e7ffe7;
    --card-bg: rgba(255,255,255,0.4);
    --btn-bg: #ffd5e5;
    --font: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    --nav-text: #4b4b4b;
    --muted-border: rgba(0,0,0,0.06);
  }

  html,body { height: 100%; }

  body {
    font-family: var(--font);
    text-align: center;
    padding-top: 1.25rem; /* small top spacing so header isn't pushed down */
    font-size: 1.25rem;
    background-image:
      linear-gradient(135deg, var(--bg1), var(--bg2), var(--bg3)),
      url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Ctext x='10' y='40' font-size='40' fill='pink' opacity='0.25'%3E%E2%9D%A4%EF%B8%8F%3C/text%3E%3C/svg%3E");
    background-size: 400% 400%, 80px 80px;
    background-repeat: no-repeat, repeat;
    animation: gradientShift 12s ease infinite;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  @keyframes gradientShift {
    0% { background-position: 0% 50%, 0 0; }
    50% { background-position: 100% 50%, 0 0; }
    100% { background-position: 0% 50%, 0 0; }
  }

  /* header layout change: brand stands alone, nav is minimal
     add a centered max-width so header content is always perfectly centered */
  header {
    position: relative;
    z-index: 1000;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
    padding-top: 0.4rem;
    width: 100%;
    max-width: 1100px;
    margin-inline: auto; /* force header content to center within viewport */
  }

  .brand {
    color: var(--accent);
    margin: 0;
    font-size: 1.35rem;
    font-weight: 800;
    letter-spacing: -0.5px;
    text-align: center;
    width: 100%;
  }

  /* brand wrapper so we can add a small mark */
  .brand-wrap {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.25rem;
  }
  .brand-mark {
    width: 44px;
    height: 44px;
    display: block;
    filter: drop-shadow(0 6px 14px rgba(214,51,132,0.12));
  }

  .top-nav {
    position: sticky;
    top: 0;
    width: 100%;
    max-width: 1100px;
    display: flex;
    justify-content: center;        /* centered and minimal */
    align-items: center;
    background: transparent;        /* minimal, no heavy backdrop */
    padding: 0.25rem 0; /* remove horizontal padding that could offset layout */
    box-shadow: none;
    border-bottom: 1px solid var(--muted-border);
  }

  .nav-links {
    display: flex;
    gap: 1rem;
    align-items: center;
    margin-inline: auto; /* keep the links centered inside the nav */
  }

  .nav-links a {
    text-decoration: none;
    color: var(--nav-text);
    padding: 0.35rem 0.6rem;
    border-radius: 999px;
    font-weight: 600;
    font-size: 0.95rem;
    transition: background-color .14s ease, color .12s ease;
    position: relative;
    cursor: pointer;
  }
  /* understated underline animation */
  .nav-links a::after {
    content: "";
    position: absolute;
    left: 50%;
    transform: translateX(-50%) scaleX(0);
    bottom: -6px;
    width: 66%;
    height: 2px;
    background: linear-gradient(90deg, rgba(214,51,132,0.95), rgba(255,154,164,0.9));
    border-radius: 2px;
    transition: transform .22s cubic-bezier(.2,.9,.25,1);
    transform-origin: center;
  }
  .nav-links a:hover::after,
  .nav-links a.active::after { transform: translateX(-50%) scaleX(1); }

  main {
    display: flex;
    justify-content: center;
    align-items: flex-start;    /* place content closer to header */
    padding-top: 1.25rem;
    min-height: calc(100vh - 5.25rem);
  }

  #content-box {
    backdrop-filter: blur(6px);
    background: var(--card-bg);
    padding: 1.6rem;
    border-radius: 20px;
    display: inline-block;
    box-shadow: 0 8px 30px rgba(0,0,0,0.08);
    max-width: 720px;
    min-width: 260px;
    text-align: center;
    /* animation + motion / accessibility helpers */
    animation: floatIn var(--card-duration) cubic-bezier(.2,.8,.2,1) both;
    will-change: transform, opacity;
  }

  /* decorative soft background circles */
  body::before {
    content: "";
    position: fixed;
    inset: -10% -20%;
    background:
      radial-gradient(600px 300px at 20% 15%, rgba(214,51,132,0.06), transparent 15%),
      radial-gradient(450px 200px at 85% 85%, rgba(34,180,171,0.04), transparent 15%);
    z-index: 0;
    pointer-events: none;
  }

  @keyframes floatIn {
    from { opacity: 0; transform: translateY(8px) scale(.997); }
    to   { opacity: 1; transform: translateY(0)    scale(1); }
  }

  #output {
    font-size: 1.25rem;
    color: #333;
    min-height: 2.25rem;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: transform .22s cubic-bezier(.2,.9,.25,1), opacity .18s ease;
    will-change: transform, opacity;
  }

  /* quick pop when text changes */
  #output.pop { transform: translateY(-6px) scale(1.02); opacity: 0.98; }

  .controls {
    margin-top: 0.9rem;
    display: flex;
    justify-content: center;
    gap: 0.75rem;
    align-items: center;
    flex-wrap: wrap;
  }

  /* ensure every button has same width and centered */
  .controls button {
    min-width: 160px;
    width: 160px;
    padding: 0.8rem 1rem;
    transition: transform .18s cubic-bezier(.2,.9,.25,1), box-shadow .18s linear, background-color .12s linear;
  }
  .controls button:hover {
    transform: translateY(calc(-1 * var(--button-lift))) scale(1.02);
    box-shadow: 0 18px 36px rgba(214,51,132,0.12);
  }
  .controls button:active { transform: translateY(2px) scale(.995); }

  button {
    font-size: 1rem;
    border-radius: 12px;
    border: none;
    background: var(--btn-bg);
    box-shadow: 0 6px 16px rgba(0,0,0,0.08);
    cursor: pointer;
    transition: transform .12s ease, box-shadow .12s ease, background-color .14s ease;
  }
  button:active { transform: translateY(1px); }
  button:focus { outline: 3px solid rgba(214,51,132,0.18); }

  /* keyboard focus is visually clear & subtle for accessibility */
  :focus-visible { outline: 3px solid rgba(214,51,132,0.18); outline-offset: 2px; border-radius: 8px; }
  a:focus-visible { outline-offset: 3px; }

  @media (min-width: 700px) {
    body { font-size: 1.5rem; }
    .brand { font-size: 1.5rem; }
  }

  /* responsive adjustments for very small screens */
  @media (max-width: 420px) {
    .controls button { width: calc(100% - 48px); max-width: 240px; }
    .controls { padding-inline: 24px; gap: 0.5rem; }
  }

  /* ----- gallery + uploader styles ----- */
  .gallery-section {
    margin-top: 1.5rem;
    width: 100%;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 0.9rem;
  }
  .uploader {
    width: 100%;
    max-width: 720px;
    display: flex;
    gap: 0.75rem;
    align-items: center;
    justify-content: center;
    flex-wrap: wrap;
  }
  .dropzone {
    flex: 1 1 320px;
    min-height: 80px;
    background: rgba(255,255,255,0.6);
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 8px 12px;
    border: 1px dashed rgba(0,0,0,0.06);
    color: #444;
    transition: box-shadow .12s ease, transform .12s ease, background-color .12s ease;
  }
  .dropzone.dragover { background: rgba(255,255,255,0.9); box-shadow: 0 8px 22px rgba(0,0,0,0.06); transform: translateY(-2px); }
  .uploader .choose {
    min-width: 160px;
    width: 160px;
  }
  .gallery-toolbar {
    width: 100%;
    max-width: 720px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: 1rem;
  }
  .gallery-info { font-size: .9rem; color: #555; }

  .gallery-grid {
    width: 100%;
    max-width: 720px;
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
    gap: 12px;
    margin-top: 6px;
  }
  .thumb {
    background: rgba(255,255,255,0.85);
    border-radius: 10px;
    overflow: hidden;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    min-height: 84px;
  }
  .thumb img { width: 100%; height: 100%; object-fit: cover; display:block; }
  .thumb .meta {
    position: absolute;
    inset: 6px;
    display: flex;
    justify-content: space-between;
    pointer-events: none;
  }
  .thumb .btns { pointer-events: auto; display:flex; gap:6px; }
  .thumb .thumb-btn {
    font-size: .8rem;
    padding: 6px 8px;
    border-radius: 8px;
    border: none;
    background: rgba(255,255,255,0.7);
    cursor: pointer;
    box-shadow: 0 4px 10px rgba(0,0,0,0.06);
  }
  .thumb .thumb-btn:active { transform: translateY(1px); }
  .empty { color: #666; padding: 18px 8px; }

  /* modal viewer */
  .viewer {
    position: fixed; inset: 0; display: none; place-items:center; z-index:12000;
    background: linear-gradient(180deg, rgba(0,0,0,0.5), rgba(0,0,0,0.65));
  }
  .viewer.show { display: grid; }
  .viewer .frame {
    max-width: min(92vw,1000px);
    max-height: 92vh;
    border-radius: 14px;
    overflow: hidden;
    background: #fff;
    box-shadow: 0 30px 80px rgba(0,0,0,0.45);
    display: flex;
    align-items:center;
    justify-content:center;
  }
  .viewer img { max-width:100%; max-height:92vh; display:block; }
  .viewer .close {
    position:absolute; top:20px; right:20px; background:rgba(255,255,255,0.9); border-radius:10px; padding:6px 8px; border:none; cursor:pointer;
  }
</style>
</head>
<body>
  <header>
    <!-- brand stands alone and centered, now with a small mark -->
    <div class="brand-wrap" aria-hidden="false">
      <svg class="brand-mark" viewBox="0 0 64 64" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false">
        <defs>
          <linearGradient id="g" x1="0" x2="1" y1="0" y2="1">
            <stop offset="0" stop-color="#ff98a4"/>
            <stop offset="1" stop-color="#d63384"/>
          </linearGradient>
        </defs>
        <g fill="url(#g)">
          <path d="M32 56s-22-14.9-22-28.2C10 14.1 21.4 8 32 15.2 42.6 8 54 14.1 54 27.8 54 41.1 32 56 32 56z"/>
        </g>
      </svg>
      <h1 class="brand">Rossi &amp; Dorka</h1>
    </div>

    <!-- minimal, centered nav -->
    <nav class="top-nav" aria-label="Hauptnavigation">
      <div class="nav-links" role="navigation" aria-label="SekundÃ¤rnavigation">
        <a href="#output">Bearbeiten</a>
        <a href="#gallery">Galerie</a>
        <a href="#events">Termine</a>
      </div>
    </nav>
  </header>

  <main>
    <div id="content-box">
      <div id="output" role="status" aria-live="polite">ðŸ’– Tippe auf den Button ðŸ’–</div>

      <div class="controls">
        <button id="new-heart" aria-pressed="false">Neues Herz</button>
      </div>

      <!-- gallery section placed under the generator button -->
      <section id="gallery" class="gallery-section" aria-label="Galerie">
        <div class="gallery-toolbar" role="region" aria-label="Bilder hochladen">
          <div class="uploader" id="uploader">
            <label class="dropzone" id="dropzone" tabindex="0">
              <input id="file-input" type="file" accept="image/*" multiple style="display:none;" />
              <div>
                <div style="font-weight:700; color:var(--nav-text);">Bilder hierher ziehen oder einfÃ¼gen</div>
                <div style="font-size:.9rem;color:#666;margin-top:6px;">Klicke zum AuswÃ¤hlen oder fÃ¼ge Bilder mit STRG+V ein</div>
              </div>
            </label>
            <button class="choose" id="choose-btn">Dateien wÃ¤hlen</button>
          </div>
          <div class="gallery-info" id="gallery-count">0 Bilder</div>
        </div>

        <div class="gallery-grid" id="gallery-grid" aria-live="polite" aria-atomic="false">
          <div class="empty" id="empty-state">Keine Bilder â€” fÃ¼ge welche hinzu!</div>
        </div>
      </section>
    </div>
  </main>

<script>
  // Kurz und resilient: zufÃ¤llige Botschaften anzeigen, event listener statt inline onclick
  const messages = [
    "Du bist toll! ðŸ’›",
    "Du bist absolut rattenscharf! ðŸ’˜",
    "Willst du eine Umarmung?",
    "Ich mag dich wirklich wirklich ganz schÃ¶n arg. ðŸ’•",
    "Ich denk an dich. ðŸŒ¸",
    "Du machst genug. Du bist genug. Du bist toll. Ich bin stolz auf dich.ðŸ’–",
    "Clash Royale GÃ¶ttin ðŸ‘‘",
    "Du bist mein Lieblingsmensch auf der ganzen Welt! ðŸŒ"
  ];

  const outputEl = document.getElementById('output');
  const btnNew = document.getElementById('new-heart');
  // wire up nav active states and keyboard/space activation
  document.querySelectorAll('.nav-links a').forEach(a => {
    a.addEventListener('click', (e) => {
      document.querySelectorAll('.nav-links a').forEach(x => x.classList.remove('active'));
      a.classList.add('active');
    });
  });

  // spacebar toggles button when focused
  btnNew?.addEventListener('keydown', (e) => {
    if (e.code === 'Space' || e.key === ' ') {
      e.preventDefault();
      btnNew.click();
    }
  });

  function pickRandom(arr){
    return arr[Math.floor(Math.random() * arr.length)];
  }

  function showMessage(){
    if (!outputEl) return;
    outputEl.textContent = pickRandom(messages);
    // brief pop animation for more life
    outputEl.setAttribute('aria-atomic','true');
    outputEl.classList.add('pop');
    setTimeout(() => outputEl.classList.remove('pop'), 320);
    // reflect pressed state briefly for accessibility
    btnNew?.setAttribute('aria-pressed', 'true');
    setTimeout(() => btnNew?.setAttribute('aria-pressed', 'false'), 360);
  }

  // small visual confetti â€” spawns a few hearts near the button to give feedback
  function spawnHearts(sourceEl, count = 6) {
    if (window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches) return;
    const rect = sourceEl.getBoundingClientRect();
    for (let i = 0; i < count; i++) {
      const el = document.createElement('span');
      el.className = 'floating-heart';
      el.textContent = ['ðŸ’–','ðŸ’—','ðŸ’“','ðŸ’˜'][Math.floor(Math.random()*4)];
      // randomize spawn around the button
      const x = rect.left + rect.width/2 + (Math.random()*120 - 60);
      const y = rect.top + (Math.random()*20 - 10);
      el.style.left = Math.round(x) + 'px';
      el.style.top  = Math.round(y) + 'px';
      el.style.transform = `translate(-50%,0) scale(${0.85 + Math.random()*0.4}) rotate(${Math.random()*40-20}deg)`;
      document.body.appendChild(el);
      // remove after animation ends (1200ms)
      setTimeout(() => el.remove(), 1400 + Math.floor(Math.random()*400));
    }
  }

  btnNew?.addEventListener('click', (e) => { showMessage(); spawnHearts(e.currentTarget); });
  btnNew?.addEventListener('keyup', (e) => { if (e.key === 'Enter') showMessage(); });

  /* ---------- persistent gallery (IndexedDB with localStorage fallback) ---------- */
  const DB_NAME = 'dorka-gallery';
  const STORE = 'images';
  let db = null;

  function openDB() {
    return new Promise(resolve => {
      if (!window.indexedDB) return resolve(null);
      const r = indexedDB.open(DB_NAME, 1);
      r.onupgradeneeded = () => { r.result.createObjectStore(STORE, { keyPath: 'id', autoIncrement: true }); };
      r.onsuccess = () => { db = r.result; resolve(db); };
      r.onerror = () => resolve(null);
    });
  }

  function storeImageBlob(blob, name) {
    // prefer IndexedDB
    return new Promise(async (resolve, reject) => {
      if (db) {
        const tx = db.transaction(STORE, 'readwrite');
        const store = tx.objectStore(STORE);
        const item = { blob, name: name || 'image', ts: Date.now() };
        const req = store.add(item);
        req.onsuccess = () => resolve({ id: req.result, ...item });
        req.onerror = () => reject(req.error);
      } else {
        // fallback: localStorage base64
        try {
          const key = 'dorka-images';
          const arr = JSON.parse(localStorage.getItem(key) || '[]');
          const data = await blobToDataURL(blob);
          const rec = { id: Date.now() + Math.random(), name: name||'image', data, ts: Date.now() };
          arr.push(rec);
          localStorage.setItem(key, JSON.stringify(arr));
          resolve(rec);
        } catch (err) { reject(err); }
      }
    });
  }

  function blobToDataURL(blob) {
    return new Promise((res, rej) => {
      const r = new FileReader();
      r.onload = () => res(r.result);
      r.onerror = rej;
      r.readAsDataURL(blob);
    });
  }

  function getAllImages() {
    return new Promise(async (resolve) => {
      if (db) {
        const tx = db.transaction(STORE,'readonly');
        const store = tx.objectStore(STORE);
        const req = store.getAll();
        req.onsuccess = () => resolve(req.result || []);
        req.onerror = () => resolve([]);
      } else {
        const arr = JSON.parse(localStorage.getItem('dorka-images') || '[]');
        resolve(arr);
      }
    });
  }

  function deleteImage(id) {
    return new Promise(resolve => {
      if (db) {
        const tx = db.transaction(STORE,'readwrite');
        tx.objectStore(STORE).delete(id).onsuccess = () => resolve(true);
      } else {
        const key = 'dorka-images';
        const arr = JSON.parse(localStorage.getItem(key) || '[]').filter(x => x.id !== id);
        localStorage.setItem(key, JSON.stringify(arr));
        resolve(true);
      }
    });
  }

  // render helpers
  const galleryGrid = document.getElementById('gallery-grid');
  const galleryCount = document.getElementById('gallery-count');
  const emptyState = document.getElementById('empty-state');
  const fileInput = document.getElementById('file-input');
  const dropzone = document.getElementById('dropzone');
  const chooseBtn = document.getElementById('choose-btn');
  const viewer = createViewer();

  function createViewer(){
    const el = document.createElement('div');
    el.className = 'viewer';
    el.innerHTML = '<div class="frame" role="dialog" aria-modal="true"></div><button class="close" aria-label="Schliessen">âœ•</button>';
    document.body.appendChild(el);
    el.querySelector('.close').addEventListener('click', () => el.classList.remove('show'));
    el.addEventListener('click', (e) => { if (e.target === el) el.classList.remove('show'); });
    return el;
  }

  function updateCount(n){
    galleryCount.textContent = `${n} Bild${n===1?'':'er'}`;
  }

  function appendThumb(rec) {
    emptyState?.remove();
    const box = document.createElement('div');
    box.className = 'thumb';
    let imgEl = document.createElement('img');
    if (rec.blob) {
      imgEl.src = URL.createObjectURL(rec.blob);
      // revoke later when removed
    } else if (rec.data) {
      imgEl.src = rec.data;
    }
    box.appendChild(imgEl);
    const meta = document.createElement('div'); meta.className = 'meta';
    const namespan = document.createElement('div'); namespan.style.fontSize='.75rem'; namespan.style.color='#222'; namespan.textContent = rec.name || '';
    const btns = document.createElement('div'); btns.className = 'btns';
    const view = document.createElement('button'); view.className = 'thumb-btn'; view.title='Vollansicht'; view.innerText = 'Ã–ffnen';
    const del = document.createElement('button'); del.className = 'thumb-btn'; del.title='LÃ¶schen'; del.innerText = 'LÃ¶schen';
    btns.appendChild(view); btns.appendChild(del);
    meta.appendChild(namespan); meta.appendChild(btns); box.appendChild(meta);

    // view handler
    view.addEventListener('click', () => {
      const frame = viewer.querySelector('.frame');
      frame.innerHTML = '';
      const img = document.createElement('img');
      if (rec.blob) img.src = URL.createObjectURL(rec.blob);
      else img.src = rec.data;
      frame.appendChild(img);
      viewer.classList.add('show');
    });

    del.addEventListener('click', async () => {
      await deleteImage(rec.id);
      box.remove();
      // update count
      const remaining = galleryGrid.querySelectorAll('.thumb').length;
      if (remaining === 0) galleryGrid.appendChild(emptyState);
      updateCount(remaining);
    });

    galleryGrid.appendChild(box);
  }

  async function loadGallery() {
    const arr = await getAllImages();
    galleryGrid.innerHTML = '';
    if (!arr || arr.length === 0) { galleryGrid.appendChild(emptyState); updateCount(0); return; }
    arr.forEach(appendThumb);
    updateCount(arr.length);
  }

  async function handleFiles(list) {
    const files = Array.from(list).filter(f => f.type && f.type.startsWith('image/'));
    for (const f of files) {
      // store as blob (file is already blob)
      try {
        const record = await storeImageBlob(f, f.name);
        appendThumb(record);
      } catch (err) {
        console.warn('Could not store image', err);
      }
    }
    const total = galleryGrid.querySelectorAll('.thumb').length;
    updateCount(total);
  }

  // input / drop / choose
  chooseBtn?.addEventListener('click', () => fileInput?.click());
  fileInput?.addEventListener('change', (e) => handleFiles(e.target.files));

  ['dragenter','dragover'].forEach(ev => dropzone?.addEventListener(ev, (e) => { e.preventDefault(); e.stopPropagation(); dropzone.classList.add('dragover'); }));
  ['dragleave','drop','dragend'].forEach(ev => dropzone?.addEventListener(ev, (e) => { e.preventDefault(); e.stopPropagation(); dropzone.classList.remove('dragover'); }));
  dropzone?.addEventListener('drop', (e) => { if (e.dataTransfer?.files?.length) handleFiles(e.dataTransfer.files); });

  // paste support
  window.addEventListener('paste', (e) => {
    const items = e.clipboardData?.items || [];
    const images = [];
    for (const it of items) {
      if (it.type && it.type.startsWith('image/')) images.push(it.getAsFile());
    }
    if (images.length) handleFiles(images);
  });

  // initialize DB and load
  (async function initGallery(){
    await openDB();
    await loadGallery();
  })();
 </script>
 </body>
 </html>